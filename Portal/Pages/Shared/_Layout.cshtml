@using Microsoft.AspNetCore.Http
@using Portal.Services
@inject IUserRoleService UserRoleService
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Portal</title>
    <!-- Include Bootstrap CSS for responsiveness -->
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    @* <link href="~/css/site.css" rel="stylesheet" /> *@
    <link href="~/css/admin.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    @RenderSection("Styles", required: false)
    <link rel="shortcut icon" href="~/Resources/mlogo.jpeg" type="image/x-icon" />
</head>
<body>
    <div>
        <!-- Sidebar Toggle for mobile view -->
        <button class="navbar-toggler" type="button" onclick="toggleSidebar()">
            ☰ Menu
        </button>

        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <h4>Asset Portal</h4>
            <hr />
            <!-- Navigation sidebar -->
            <ul class="nav flex-column" id="dashboardSidebar">
                <li class="nav-item">
                    <a class="nav-link" asp-area="" asp-page="/Index">
                        <i class="bi bi-house-fill me-2"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" asp-area="" asp-page="/Assets/Index">
                        <i class="bi bi-briefcase-fill me-2"></i>
                        <span>Assets</span>
                    </a>
                </li>
                @if (UserRoleService.IsInRole("Admin"))
                {
                    <li class="nav-item">
                        <a class="nav-link" asp-area="" asp-page="/Categories/Index">
                            <i class="bi bi-tags-fill me-2"></i>
                            <span>Categories</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" asp-area="" asp-page="/Departments/Index">
                            <i class="bi bi-building-fill me-2"></i>
                            <span>Departments</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" asp-area="" asp-page="/Locations/Index">
                            <i class="bi bi-geo-alt-fill me-2"></i>
                            <span>Locations</span>
                        </a>
                    </li>
                }
                <li class="nav-item">
                    <a class="nav-link" asp-area="" asp-page="/Users/Index">
                        <i class="bi bi-people-fill me-2"></i>
                        <span>Users</span>
                    </a>
                </li>
                <li class="nav-item">
                    <form method="post" asp-page="/Account/Logout" class="m-0 p-0">
                        <button type="submit" class="nav-link btn btn-link text-white w-100 text-start" style="text-decoration:none;">
                            <i class="bi bi-power me-2"></i>
                            <span>Logout</span>
                        </button>
                    </form>
                </li>
            </ul>

            <!-- Button to navigate to the Index page -->
            <div class="text-center mt-4">
                <a href="/" class="btn btn-primary btn-block">Go to Homepage</a>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="content" onclick="hideSidebarOnOutsideClick(event)">
            @RenderBody()
            <hr />
            <footer>
                <p>&copy; @DateTime.Now.Year - My ASP.NET Application</p>
            </footer>
        </div>
    </div>

    <!-- Include jQuery and Bootstrap JS -->
    @* <script src="~/lib/jquery/jquery.min.js"></script>
    <script src="~/lib/modernizr/modernizr-2.8.3.js"></script> *@
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JavaScript for sidebar toggle and active link -->
    <script>
        function toggleSidebar() {
            var sidebar = document.getElementById("sidebar");
            sidebar.classList.toggle("active");
        }
        // Function to hide sidebar on outside click
        function hideSidebarOnOutsideClick(event) {
            var sidebar = document.getElementById("sidebar");
            if (window.innerWidth <= 768) { // Only apply this behavior on mobile
                if (sidebar.classList.contains('active') && !sidebar.contains(event.target)) {
                    sidebar.classList.remove('active');
                }
            }
        }

        // Close sidebar if clicking outside of it
        document.addEventListener('click', function (event) {
            var sidebar = document.getElementById("sidebar");
            var toggleButton = document.querySelector('.navbar-toggler');

            if (window.innerWidth <= 768) { // Only apply this behavior on mobile
                if (sidebar.classList.contains('active') && !sidebar.contains(event.target) && !toggleButton.contains(event.target)) {
                    sidebar.classList.remove('active');
                }
            }
        });

        // Get the current page path
        const activePage = window.location.pathname;

            // Highlight the active link in the sidebar
        const navLinks = document.querySelectorAll('#dashboardSidebar .nav-link');
        navLinks.forEach(link => {
            // Extract the pathname from the link's href (normalizes to relative path)
            const linkPath = new URL(link.href, window.location.origin).pathname;

            // Remove active class from all links first (resets previous state)
            link.classList.remove('active');

            // Add active if exact match OR current path is a child of link path
            if (activePage === linkPath || activePage.startsWith(linkPath + '/')) {
                link.classList.add('active');
            }
        });

    </script>

    @RenderSection("Scripts", required: false)
</body>
</html>

