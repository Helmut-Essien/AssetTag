<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:MobileApp.ViewModels"
             xmlns:inputLayout="clr-namespace:Syncfusion.Maui.Toolkit.TextInputLayout;assembly=Syncfusion.Maui.Toolkit"
             xmlns:buttons="clr-namespace:Syncfusion.Maui.Toolkit.Buttons;assembly=Syncfusion.Maui.Toolkit"
             x:Class="MobileApp.Views.LoginPage"
             x:DataType="viewmodels:LoginViewModel"
             Shell.NavBarIsVisible="False">

    <ContentPage.Resources>
        <ResourceDictionary>
            <!-- Gradient Background -->
            <LinearGradientBrush x:Key="LoginGradient" StartPoint="0,0" EndPoint="1,1">
                <GradientStop Color="#512BD4" Offset="0.0" />
                <GradientStop Color="#2B0B98" Offset="1.0" />
            </LinearGradientBrush>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid Background="{StaticResource LoginGradient}">
        
        <!-- Animated Background Circles -->
        <Grid.Resources>
            <Style TargetType="BoxView" x:Key="CircleStyle">
                <Setter Property="CornerRadius" Value="200"/>
                <Setter Property="Opacity" Value="0.1"/>
            </Style>
        </Grid.Resources>

        <BoxView Style="{StaticResource CircleStyle}"
                 WidthRequest="400"
                 HeightRequest="400"
                 BackgroundColor="White"
                 HorizontalOptions="Start"
                 VerticalOptions="Start"
                 Margin="-200,-200,0,0"/>

        <BoxView Style="{StaticResource CircleStyle}"
                 WidthRequest="300"
                 HeightRequest="300"
                 BackgroundColor="White"
                 HorizontalOptions="End"
                 VerticalOptions="End"
                 Margin="0,0,-150,-150"/>

        <!-- Main Content -->
        <ScrollView>
            <VerticalStackLayout Padding="40,60,40,40"
                                Spacing="30"
                                VerticalOptions="Center">

                <!-- Logo Container with Shadow -->
                <Border BackgroundColor="White"
                        StrokeThickness="0"
                        Padding="25"
                        HorizontalOptions="Center"
                        WidthRequest="180"
                        HeightRequest="180">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="30"/>
                    </Border.StrokeShape>
                    <Border.Shadow>
                        <Shadow Brush="Black"
                                Offset="0,8"
                                Radius="20"
                                Opacity="0.3"/>
                    </Border.Shadow>
                    <Image Source="methodist_university_logo.png"
                           Aspect="AspectFit"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"/>
                </Border>

                <!-- Welcome Text -->
                <VerticalStackLayout Spacing="8">
                    <Label Text="Welcome Back"
                           FontSize="36"
                           FontAttributes="Bold"
                           TextColor="White"
                           HorizontalTextAlignment="Center"/>
                    <Label Text="Sign in to your account"
                           FontSize="16"
                           TextColor="White"
                           Opacity="0.9"
                           HorizontalTextAlignment="Center"/>
                </VerticalStackLayout>

                <!-- Login Form Card -->
                <Border BackgroundColor="White"
                        StrokeThickness="0"
                        Padding="25"
                        Margin="0,10,0,0">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="20"/>
                    </Border.StrokeShape>
                    <Border.Shadow>
                        <Shadow Brush="Black"
                                Offset="0,10"
                                Radius="30"
                                Opacity="0.2"/>
                    </Border.Shadow>

                    <VerticalStackLayout Spacing="25">
                        
                        <!-- Email Field with Syncfusion TextInputLayout -->
                        <inputLayout:SfTextInputLayout 
                            Hint="Email Address"
                            HelperText="Enter your registered email"
                            LeadingViewPosition="Inside"
                            ContainerType="Outlined"
                            OutlineCornerRadius="12">
                            <inputLayout:SfTextInputLayout.LeadingView>
                                <Label Text="ðŸ“§" 
                                       FontSize="20"
                                       VerticalOptions="Center"
                                       Margin="5,0,0,0"/>
                            </inputLayout:SfTextInputLayout.LeadingView>
                            <Entry Text="{Binding Email}"
                                   Keyboard="Email"
                                   TextColor="{StaticResource Gray900}"
                                   FontSize="16"/>
                        </inputLayout:SfTextInputLayout>

                        <!-- Password Field with Syncfusion TextInputLayout -->
                        <inputLayout:SfTextInputLayout 
                            Hint="Password"
                            HelperText="Enter your password"
                            LeadingViewPosition="Inside"
                            ContainerType="Outlined"
                            OutlineCornerRadius="12"
                            EnablePasswordVisibilityToggle="True">
                            <inputLayout:SfTextInputLayout.LeadingView>
                                <Label Text="ðŸ”’" 
                                       FontSize="20"
                                       VerticalOptions="Center"
                                       Margin="5,0,0,0"/>
                            </inputLayout:SfTextInputLayout.LeadingView>
                            <Entry Text="{Binding Password}"
                                   IsPassword="True"
                                   TextColor="{StaticResource Gray900}"
                                   FontSize="16"/>
                        </inputLayout:SfTextInputLayout>

                        <!-- Error Message -->
                        <Border IsVisible="{Binding HasError}"
                                BackgroundColor="#FFEBEE"
                                StrokeThickness="1"
                                Stroke="#EF5350"
                                Padding="15,12">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="10"/>
                            </Border.StrokeShape>
                            <HorizontalStackLayout Spacing="10">
                                <Label Text="âš ï¸" 
                                       FontSize="18"
                                       VerticalOptions="Center"/>
                                <Label Text="{Binding ErrorMessage}"
                                       TextColor="#C62828"
                                       FontSize="14"
                                       VerticalOptions="Center"
                                       LineBreakMode="WordWrap"
                                       HorizontalOptions="FillAndExpand"/>
                            </HorizontalStackLayout>
                        </Border>

                        <!-- Login Button with Syncfusion -->
                        <buttons:SfButton 
                            Text="Sign In"
                            Command="{Binding LoginCommand}"
                            CornerRadius="25"
                            HeightRequest="56"
                            FontSize="18"
                            FontAttributes="Bold"
                            Margin="0,10,0,0">
                            <buttons:SfButton.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                    <GradientStop Color="#512BD4" Offset="0.0" />
                                    <GradientStop Color="#2B0B98" Offset="1.0" />
                                </LinearGradientBrush>
                            </buttons:SfButton.Background>
                            <buttons:SfButton.Shadow>
                                <Shadow Brush="#512BD4"
                                        Offset="0,6"
                                        Radius="15"
                                        Opacity="0.4"/>
                            </buttons:SfButton.Shadow>
                        </buttons:SfButton>

                        <!-- Loading Indicator -->
                        <ActivityIndicator IsRunning="{Binding IsBusy}"
                                          IsVisible="{Binding IsBusy}"
                                          Color="{StaticResource Primary}"
                                          HeightRequest="40"/>

                        <!-- Biometric Login Button -->
                        <buttons:SfButton
                            Text="ðŸ” Login with Biometrics"
                            Command="{Binding BiometricLoginCommand}"
                            IsVisible="{Binding BiometricAvailable}"
                            CornerRadius="25"
                            HeightRequest="56"
                            FontSize="16"
                            Margin="0,10,0,0"
                            BackgroundColor="Transparent"
                            Stroke="{StaticResource Primary}"
                            StrokeThickness="2"
                            TextColor="{StaticResource Primary}"/>

                        <!-- Forgot Password -->
                        <Button Text="Forgot Password?"
                                Command="{Binding ForgotPasswordCommand}"
                                BackgroundColor="Transparent"
                                TextColor="{StaticResource Primary}"
                                FontSize="14"
                                FontAttributes="Bold"
                                Margin="0,5,0,0"/>

                    </VerticalStackLayout>
                </Border>

                <!-- App Version -->
                <Label Text="AssetTag Mobile v1.0"
                       FontSize="12"
                       TextColor="White"
                       Opacity="0.7"
                       HorizontalTextAlignment="Center"
                       Margin="0,20,0,0"/>

            </VerticalStackLayout>
        </ScrollView>
    </Grid>

</ContentPage>